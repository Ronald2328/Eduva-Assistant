# 7.1 Railway Setup

## Creación de Proyecto en Railway

### Paso 1: Crear Proyecto

1. Ir a [railway.app](https://railway.app)
2. Click en **"New Project"**
3. Seleccionar **"Deploy from GitHub repo"**
4. Autorizar GitHub
5. Seleccionar repositorio `UNP/BOT`

---

## Conexión con GitHub

Railway detecta automáticamente cambios en GitHub:

```
git push origin main
→ Railway detecta push
→ Construye imagen Docker
→ Deploya automáticamente
```

---

## Configuración de Build

Railway detecta automáticamente el Dockerfile:

```dockerfile
# Dockerfile

FROM python:3.12-slim
WORKDIR /app

# Instalar uv
COPY --from=ghcr.io/astral-sh/uv:latest /uv /bin/uv

# Copiar dependencias
COPY pyproject.toml uv.lock ./
RUN uv sync --frozen --no-cache

# Copiar código
COPY . .

# Exponer puerto
EXPOSE 8000

# Comando de inicio
CMD ["uv", "run", "fastapi", "run", "app/main.py", "--host", "0.0.0.0", "--port", "8000"]
```

---

## Comando de Inicio

Railway ejecuta el `CMD` del Dockerfile:

```bash
uv run fastapi run app/main.py --host 0.0.0.0 --port 8000
```

---

## Health Checks

Railway verifica que el servicio esté vivo:

**Endpoint**: `/health`

```python
@router.get("/health")
async def health_check():
    return {"status": "healthy"}
```

**Configuración**:
- Intervalo: 30 segundos
- Timeout: 10 segundos
- Reintentos: 3 fallos → Reinicia servicio

---

## Agregar Servicios Adicionales

### PostgreSQL

```bash
+ New → Database → PostgreSQL
```

Railway automáticamente:
- Crea base de datos
- Genera credenciales
- Inyecta variables de entorno (`DATABASE_URL`)

### Redis

```bash
+ New → Database → Redis
```

Railway automáticamente:
- Crea instancia Redis
- Genera credenciales
- Inyecta `REDIS_URL`

### Evolution API

```bash
+ New → Docker Image → atendai/evolution-api:latest
```

Configurar variables:
```bash
DATABASE_URL=${{Postgres.DATABASE_URL}}
REDIS_URL=${{Redis.REDIS_URL}}
```

---

**Volver al índice**: [../README.md](../README.md)
