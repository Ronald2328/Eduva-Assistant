# 5.2 Herramientas (Tools)

## Tool: search_documents

```python
# app/science_bot/agent/tools/search_documents/tool.py

from langchain_core.tools import tool

@tool
async def search_documents(
    query: str,
    school: SchoolEnum,
) -> SearchDocumentsResponse:
    """
    Searches for information in academic documents from UNP.

    IMPORTANT: Only use this tool AFTER confirming which school the user is asking about.

    Args:
        query: User's search question
        school: Specific school/faculty (49 options)

    Returns:
        Generated response based on documents
    """
    try:
        async with SearchDocumentsService() as service:
            result = await service.search_and_answer(query=query, school=school.value)

            return SearchDocumentsResponse(
                success=result.success,
                message=result.message,
            )
    except Exception as e:
        return SearchDocumentsResponse(
            success=False,
            message=f"Error searching documents: {str(e)}",
        )
```

---

## SchoolEnum (49 Escuelas)

```python
class SchoolEnum(str, Enum):
    ADMINISTRACION = "Ciencias Administrativas"
    AGRONOMIA = "Agronomía"
    AGRICOLA = "Ingeniería Agrícola"
    CONTABILIDAD = "Ciencias Contables y Financieras"
    ECONOMIA = "Economía"
    INDUSTRIAL = "Ingeniería Industrial"
    INFORMATICA = "Ingeniería Informática"
    AGROINDUSTRIAL = "Ingeniería Agroindustrial e Industrias Alimentarias"
    MECATRONICA = "Ingeniería Mecatrónica"
    MINAS = "Ingeniería de Minas"
    GEOLOGICA = "Ingeniería Geológica"
    PETROLEO = "Ingeniería de Petróleo"
    QUIMICA = "Ingeniería Química"
    AMBIENTAL = "Ingeniería Ambiental y Seguridad Industrial"
    PESQUERA = "Ingeniería Pesquera"
    ZOOTECNIA = "Ingeniería Zootecnia"
    VETERINARIA = "Medicina Veterinaria"
    MEDICINA = "Medicina Humana"
    ENFERMERIA = "Enfermería"
    OBSTETRICIA = "Obstetricia"
    PSICOLOGIA = "Psicología"
    ESTOMATOLOGIA = "Estomatología"
    HISTORIA = "Historia y Geografía"
    LENGUA_LITERATURA = "Lengua y Literatura"
    EDUCACION_INICIAL = "Educación Inicial"
    EDUCACION_PRIMARIA = "Educación Primaria"
    COMUNICACION = "Ciencias de la Comunicación Social"
    DERECHO = "Derecho y Ciencias Políticas"
    MATEMATICA = "Matemática"
    FISICA = "Física"
    BIOLOGIA = "Ciencias Biológicas"
    ELECTRONICA = "Ingeniería Electrónica y Telecomunicaciones"
    ESTADISTICA = "Estadística"
    CIVIL = "Ingeniería Civil"
    ARQUITECTURA = "Arquitectura y Urbanismo"
    # ... más escuelas
```

---

## Binding de Tools con OpenAI

```python
# app/science_bot/agent/graph.py

model = ChatOpenAI(model="gpt-4o-mini", temperature=0)

# Bind tools con strict mode
model_with_tools = model.bind_tools(tools=TOOLS, strict=True)
```

**`strict=True`**: OpenAI garantiza que el output sigue el schema exacto.

---

## Strict Mode (Structured Outputs)

**Sin strict mode**:
```json
{
  "tool_calls": [{
    "name": "search_documents",
    "arguments": "{\"query\": \"matrícula\", \"scool\": \"INFORMATICA\"}"  // ❌ typo: "scool"
  }]
}
```

**Con strict mode**:
```json
{
  "tool_calls": [{
    "name": "search_documents",
    "arguments": {
      "query": "matrícula",
      "school": "INFORMATICA"  // ✅ Schema respetado
    }
  }]
}
```

---

## Respuestas Estructuradas

```python
class SearchDocumentsResponse(BaseModel):
    success: bool
    message: str
```

**Ejemplo**:
```python
SearchDocumentsResponse(
    success=True,
    message="Según el Reglamento de Pagos 2024, el costo de matrícula es de S/ 350 soles..."
)
```

---

## Lista de Tools

```python
TOOLS: list[BaseTool] = [search_documents]
```

**Futuras expansiones**:
```python
TOOLS = [
    search_documents,
    calculate_fees,      # Calcular costos totales
    check_schedule,      # Verificar horarios
    find_professor,      # Buscar docentes
]
```

---

**Volver al índice**: [../README.md](../README.md)
